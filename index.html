<!DOCTYPE html>
<html>
<head>
    <title>ì¡°ì„ ì‹œëŒ€ ëŸ¬ë¸Œë ˆí„°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { text-align: center; font-family: 'Noto Sans KR', sans-serif; background-color: #2e2b26; color: #f0e6d2; margin: 0; padding: 0; overflow: hidden; }
        #login-screen { display: flex; flex-direction: column; justify-content: center; height: 100vh; align-items: center; }
        input { padding: 15px; font-size: 20px; border-radius: 5px; border: 2px solid #8c7b6c; background-color: #4a4036; color: white; text-align: center; margin-bottom: 20px; width: 80%; max-width: 300px; }
        .btn-custom { padding: 15px 30px; font-size: 22px; background-color: #a63737; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
        #game-screen { display: none; max-width: 600px; margin: 0 auto; padding: 10px; height: 100vh; flex-direction: column; box-sizing: border-box; }
        #top-bar { display: flex; flex-direction: column; background: rgba(0,0,0,0.4); border-radius: 10px; margin-bottom: 5px; padding: 10px; border: 1px solid #5c5042; }
        #game-log { background: rgba(0,0,0,0.3); height: 18vh; overflow-y: auto; padding: 10px; border-radius: 10px; font-size: 14px; margin-bottom: 5px; text-align: left; border: 1px solid #5c5042; }
        #hand-container { display: flex; justify-content: center; gap: 10px; flex: 1; align-items: center; }
        .card { background: #f5f0e1; color: #2e2b26; width: 150px; height: 230px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid #d4c5a9; cursor: pointer; text-align: center; padding: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.6); box-sizing: border-box; }
        .card-name { font-size: 22px; margin-bottom: 8px; font-family: "Gungsuh", serif; font-weight: bold; }
        .card-desc { font-size: 12px; line-height: 1.3; color: #333; }
        .card.disabled { opacity: 0.5; filter: grayscale(1); }
        #mini-card-area { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px 8px; margin-top: auto; border: 1px solid #5c5042; }
        .mini-card-wrap { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; }
        
        /* ë¯¸ë‹ˆì¹´ë“œ ë””ìì¸ ë³´ì™„ */
        .mini-card { width: 22%; height: 75px; background: #5c5042; color: #e0d0b8; border-radius: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #3d342b; }
        .mini-card b { font-size: 14px; margin-top: 2px; }
        .mini-card span { font-size: 10px; margin: 3px 0; }
        .mini-card .count-txt { font-size: 9px; color: #aaa; }
        .mini-card.sold-out { background: #1a1a1a; color: #555; opacity: 0.6; }

        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        .overlay-btn { padding: 15px; margin: 5px; width: 85%; max-width: 250px; background: #4a4036; color: white; border: 1px solid #8c7b6c; border-radius: 5px; font-size: 18px; }
        #notice-box { background: #f5f0e1; color: #2e2b26; padding: 25px; border-radius: 10px; width: 80%; max-width: 300px; border: 5px solid #a63737; }
    </style>
</head>
<body>
    <div id="login-screen">
        <h1 style="color: #e6b322; font-size: 45px; font-family: 'Gungsuh';">ì¡°ì„ ì‹œëŒ€<br>ëŸ¬ë¸Œë ˆí„°</h1>
        <input type="text" id="nickname" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì‹œì˜¤" />
        <button class="btn-custom" onclick="joinGame()">ì…ì¥í•˜ê¸°</button>
    </div>

    <div id="game-screen">
        <div id="top-bar">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="room-info-display" style="font-size: 14px;">ì¸ì›: <span id="player-count">0</span>/4</span>
                <button id="start-btn" onclick="requestStart()" style="display:none; background:#3e6b46; color:white; border:none; border-radius:5px; padding:8px 15px; font-weight:bold; cursor:pointer;">â–¶ ì‹œì‘í•˜ê¸°</button>
            </div>
            <div id="player-names-box" style="font-size:12px; margin-top:5px; text-align:left; color:#9c8e7e;"></div>
        </div>
        <div id="game-log"></div>
        <div id="turn-info" style="color:#e6b322; font-weight:bold; margin: 5px 0;">ì…ì¥ ì™„ë£Œ</div>
        <div id="hand-container">
            <div class="card disabled" id="card0" onclick="clickCard(0)"></div>
            <div class="card disabled" id="card1" onclick="clickCard(1)"></div>
        </div>
        <div id="mini-card-area">
            <div style="font-size:11px; color:#e6b322; margin-bottom:8px;">ğŸ“‹ ë‚¨ì€ ì¹´ë“œ (í´ë¦­ ì‹œ ëŠ¥ë ¥ í™•ì¸)</div>
            <div id="mini-card-container" class="mini-card-wrap"></div>
        </div>
    </div>

    <div id="target-overlay" class="overlay">
        <h2 style="color: #f0e6d2;">ëŒ€ìƒ í”Œë ˆì´ì–´ ì„ íƒ</h2>
        <div id="target-buttons" style="display:flex; flex-direction:column; align-items:center; width:100%;"></div>
        <button class="overlay-btn" style="background:#333;" onclick="closeOverlay()">ì·¨ì†Œ</button>
    </div>

    <div id="guess-overlay" class="overlay">
        <h2 style="color: #f0e6d2;">ìƒëŒ€ì˜ íŒ¨ëŠ”?</h2>
        <div id="guess-buttons" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; width:85%;">
            <button class="overlay-btn" onclick="submitPlay('2')">ğŸ­ê´‘ëŒ€(2)</button>
            <button class="overlay-btn" onclick="submitPlay('3')">âš”ï¸ê²€ê°(3)</button>
            <button class="overlay-btn" onclick="submitPlay('4')">ğŸ’Šì˜ë…€(4)</button>
            <button class="overlay-btn" onclick="submitPlay('5')">ğŸ—¡ï¸ìê°(5)</button>
            <button class="overlay-btn" onclick="submitPlay('6')">ğŸ‘‘ì„ê¸ˆ(6)</button>
            <button class="overlay-btn" onclick="submitPlay('7')">ğŸŒºí›„ê¶(7)</button>
            <button class="overlay-btn" onclick="submitPlay('8')">ğŸ‘¸ì™•ë¹„(8)</button>
        </div>
    </div>

    <div id="notice-overlay" class="overlay">
        <div id="notice-box"><div id="notice-msg"></div><br><button class="btn-custom" onclick="closeNotice()">í™•ì¸</button></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myName = "", myHand = [], isMyTurn = false, selectedCard = "", players = [];
        const cardInfo = {
            "1": { emoji: "ğŸ‘®â€â™‚ï¸", name: "í¬ì¡¸", desc: "ìƒëŒ€ì˜ ìˆ«ìë¥¼ ë§ì¶”ë©´ íƒˆë½ì‹œí‚´ (1 ì œì™¸)" },
            "2": { emoji: "ğŸ­", name: "ê´‘ëŒ€", desc: "ìƒëŒ€ì˜ íŒ¨ë¥¼ ë‚˜ë§Œ ëª°ë˜ ë´…ë‹ˆë‹¤." },
            "3": { emoji: "âš”ï¸", name: "ê²€ê°", desc: "íŒ¨ ë¹„êµ í›„ ë‚®ì€ ìˆ«ìê°€ íƒˆë½í•©ë‹ˆë‹¤." },
            "4": { emoji: "ğŸ’Š", name: "ì˜ë…€", desc: "í•œ í„´ ë™ì•ˆ ëª¨ë“  ê³µê²©ì„ ë§‰ìŠµë‹ˆë‹¤." },
            "5": { emoji: "ğŸ—¡ï¸", name: "ìê°", desc: "ìƒëŒ€ê°€ íŒ¨ë¥¼ ë²„ë¦¬ê³  ìƒˆë¡œ ë½‘ê²Œ í•©ë‹ˆë‹¤." },
            "6": { emoji: "ğŸ‘‘", name: "ì„ê¸ˆ", desc: "ìƒëŒ€ì™€ íŒ¨ë¥¼ ì„œë¡œ êµí™˜í•©ë‹ˆë‹¤." },
            "7": { emoji: "ğŸŒº", name: "í›„ê¶", desc: "ì„ê¸ˆ(6)ì´ë‚˜ ìê°(5)ê³¼ í•¨ê»˜ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ë²„ë¦¼" },
            "8": { emoji: "ğŸ‘¸", name: "ì™•ë¹„", desc: "ë²„ë ¤ì§€ë©´ ì¦‰ì‹œ íƒˆë½í•©ë‹ˆë‹¤." }
        };

        function showNotice(msg) { document.getElementById('notice-msg').innerText = msg; document.getElementById('notice-overlay').style.display = 'flex'; }
        function closeNotice() { document.getElementById('notice-overlay').style.display = 'none'; }
        
        function joinGame() {
            myName = document.getElementById('nickname').value;
            if(!myName) return showNotice("ì´ë¦„ì„ ì…ë ¥í•˜ì‹œì˜¤!");
            socket.emit('login', { name: myName });
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
        }

        function requestStart() {
            const btn = document.getElementById('start-btn');
            btn.style.display = 'none'; // í´ë¦­ ì‹œ ìˆ¨ê¹€
            socket.emit('requestStart');
        }

        socket.on('updateHand', (hand) => {
            myHand = hand;
            for(let i=0; i<2; i++) {
                const el = document.getElementById('card' + i);
                if(myHand[i]) {
                    const num = myHand[i].match(/\d+/)[0];
                    el.innerHTML = `<div class="card-name">${cardInfo[num].emoji}${cardInfo[num].name}(${num})</div><div class="card-desc">${cardInfo[num].desc}</div>`;
                    el.classList.remove('disabled');
                } else { el.innerHTML = "íŒ¨ ì—†ìŒ"; el.classList.add('disabled'); }
            }
        });

        socket.on('roomInfo', (data) => {
            players = data.playerStates;
            document.getElementById('player-count').innerText = data.count;
            const btn = document.getElementById('start-btn');
            if(data.count >= 2 && !data.isStarted) {
                btn.style.display = 'block';
                btn.innerText = "â–¶ ì‹œì‘í•˜ê¸°";
            } else if (data.isStarted) {
                btn.style.display = 'none';
            }
            document.getElementById('player-names-box').innerHTML = data.playerStates.map(p => `<span style="${p.isEliminated ? 'text-decoration:line-through;color:red;' : ''}">${p.name}</span>`).join(" | ");
        });

        socket.on('gameOver', () => {
            const btn = document.getElementById('start-btn');
            btn.style.display = 'block';
            btn.style.background = '#e6b322';
            btn.innerText = "ğŸ”„ í•œ íŒ ë”!";
        });

        socket.on('turnUpdate', (data) => {
            isMyTurn = (data.turnName === myName);
            document.getElementById('turn-info').innerText = isMyTurn ? "ğŸ”´ ë‹¹ì‹ ì˜ ì°¨ë¡€!" : `âŒ› ${data.turnName}ì˜ ì°¨ë¡€...`;
        });

        socket.on('gameLog', (msg) => {
            const log = document.getElementById('game-log');
            log.innerHTML += `<div>${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        });

        socket.on('privateNotice', (msg) => showNotice(msg));

        function clickCard(idx) {
            if(!isMyTurn || !myHand[idx]) return;
            selectedCard = myHand[idx];
            if((selectedCard.includes("ìê°") || selectedCard.includes("ì„ê¸ˆ")) && myHand.some(c => c.includes("í›„ê¶"))) return showNotice("í›„ê¶ì„ ë¨¼ì € ë²„ë ¤ì•¼ í•˜ì˜¤!");
            const targets = ["í¬ì¡¸", "ê´‘ëŒ€", "ê²€ê°", "ìê°", "ì„ê¸ˆ"];
            if(targets.some(t => selectedCard.includes(t))) {
                const container = document.getElementById('target-buttons');
                container.innerHTML = "";
                players.forEach(p => {
                    if(!p.isEliminated && p.name !== myName) {
                        const btn = document.createElement('button'); btn.className = "overlay-btn"; btn.innerText = p.name;
                        btn.onclick = () => selectTarget(p.name); container.appendChild(btn);
                    }
                });
                if(container.innerHTML === "") selectTarget(myName); 
                else document.getElementById('target-overlay').style.display = 'flex';
            } else { submitPlay(); }
        }

        let selectedTarget = "";
        function selectTarget(name) {
            selectedTarget = name;
            document.getElementById('target-overlay').style.display = 'none';
            if(selectedCard.includes("í¬ì¡¸") && selectedTarget !== myName) document.getElementById('guess-overlay').style.display = 'flex';
            else submitPlay();
        }

        function submitPlay(guess = "") { socket.emit('playCard', { card: selectedCard, target: selectedTarget, guess: guess }); closeOverlay(); }
        function closeOverlay() { document.querySelectorAll('.overlay').forEach(o => { if(o.id !== 'notice-overlay') o.style.display = 'none'; }); }

        socket.on('updateCardStats', (stats) => {
            document.getElementById('mini-card-container').innerHTML = stats.map(s => {
                const isSoldOut = s.remaining === 0 ? "sold-out" : "";
                return `
                <div class="mini-card ${isSoldOut}" onclick="showNotice('${s.emoji}${s.name}: ${cardInfo[s.num].desc}')">
                    <b>${s.emoji}</b>
                    <span>${s.name} (${s.num})</span>
                    <div class="count-txt">ë‚¨ì€ì¹´ë“œ ${s.remaining}/${s.total}</div>
                </div>`;
            }).join("");
        });
    </script>
</body>
</html>
