<!DOCTYPE html>
<html>
  <head>
    <title>ì¡°ì„ ì‹œëŒ€ ëŸ¬ë¸Œë ˆí„°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      body { text-align: center; font-family: 'Noto Sans KR', sans-serif; background-color: #2e2b26; color: #f0e6d2; margin: 0; padding: 0; }
      #login-screen { display: flex; flex-direction: column; justify-content: center; height: 100vh; align-items: center; }
      input { padding: 15px; font-size: 20px; border-radius: 5px; margin-bottom: 20px; width: 80%; max-width: 300px; }
      .btn-custom { padding: 15px 30px; font-size: 22px; background-color: #a63737; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
      #game-screen { display: none !important; max-width: 600px; margin: 0 auto; padding: 10px; height: 100vh; flex-direction: column; }
      #game-log { background: rgba(0,0,0,0.3); height: 15vh; overflow-y: auto; padding: 10px; border-radius: 10px; font-size: 14px; margin-bottom: 5px; text-align: left; }
      #hand-container { display: flex; justify-content: center; gap: 10px; flex: 1; align-items: center; }
      .card { background: #f5f0e1; color: #2e2b26; width: 140px; height: 210px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid #d4c5a9; cursor: pointer; }
      .card.disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }
      .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
      .overlay-btn { padding: 15px; margin: 5px; width: 80%; max-width: 200px; background: #4a4036; color: white; border: 1px solid #8c7b6c; border-radius: 5px; }
      #notice-box { background: #2e2b26; border: 2px solid #e6b322; padding: 20px; border-radius: 10px; width: 250px; }
    </style>
  </head>
  <body>
    <div id="login-screen">
      <h1 style="color: #e6b322; font-family: 'Gungsuh';">ì¡°ì„ ì‹œëŒ€ ëŸ¬ë¸Œë ˆí„°</h1>
      <input type="text" id="nickname" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì‹œì˜¤" />
      <button class="btn-custom" onclick="joinGame()">ì…ì¥í•˜ê¸°</button>
    </div>

    <div id="game-screen">
      <div id="game-log"></div>
      <div id="turn-info" style="font-size: 20px; color: #e6b322; margin: 10px 0;">ëŒ€ê¸° ì¤‘...</div>
      <div id="hand-container">
        <div class="card disabled" id="card0" onclick="clickCard(0)"></div>
        <div class="card disabled" id="card1" onclick="clickCard(1)"></div>
      </div>
    </div>

    <div id="target-overlay" class="overlay">
      <h2 style="color: white;">ëˆ„êµ¬ë¥¼ ì§€ëª©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
      <div id="target-buttons"></div>
      <button class="btn-custom" style="margin-top:20px; font-size: 16px;" onclick="closeOverlay()">ì·¨ì†Œ</button>
    </div>

    <div id="notice-overlay" class="overlay">
      <div id="notice-box">
        <div id="notice-text" style="color: white; margin-bottom: 20px;"></div>
        <button class="btn-custom" style="font-size: 14px;" onclick="closeOverlay()">í™•ì¸</button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();
      var myHand = [], currentPlayers = [], isMyTurn = false, selectedCardIdx = -1, myName = "";

      function joinGame() {
        myName = document.getElementById('nickname').value;
        if(!myName) return alert("ì´ë¦„ì„ ì ìœ¼ì‹œì˜¤!");
        socket.emit('login', { name: myName });
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('game-screen').style.setProperty('display', 'flex', 'important');
      }

      socket.on('roomInfo', (data) => {
        currentPlayers = data.playerStates || [];
        document.getElementById('turn-info').innerText = data.isStarted ? "ê²Œì„ ì§„í–‰ ì¤‘" : "ëª¨ë‘ ì˜¤ë©´ ì‹œì‘ì„ ëˆ„ë¥´ì‹œì˜¤";
      });

      socket.on('turnUpdate', (data) => {
        isMyTurn = (data.turnId === socket.id);
        document.getElementById('turn-info').innerText = isMyTurn ? "ğŸ”¥ ë‹¹ì‹ ì˜ ì°¨ë¡€!" : `â³ ${data.turnName} ì°¨ë¡€`;
        document.querySelectorAll('.card').forEach(c => isMyTurn ? c.classList.remove('disabled') : c.classList.add('disabled'));
      });

      socket.on('updateHand', (cards) => {
        myHand = cards;
        const render = (id, c) => document.getElementById(id).innerHTML = c ? `<div style="font-size:24px;">${c}</div>` : "";
        render('card0', myHand[0]); render('card1', myHand[1]);
      });

      function clickCard(idx) {
        if(!isMyTurn || !myHand[idx]) return;
        selectedCardIdx = idx;
        const card = myHand[idx];
        if(card.includes("ì˜ë…€") || card.includes("í›„ê¶") || card.includes("ì™•ë¹„")) {
          socket.emit('playCard', { card, target: "" });
        } else {
          let html = "";
          currentPlayers.forEach(p => {
            if(p.name !== myName && !p.isEliminated) {
              html += `<button class="overlay-btn" onclick="sendMove('${p.name}')">${p.name}</button>`;
            }
          });
          document.getElementById('target-buttons').innerHTML = html || "ì§€ëª©í•  ìƒì¡´ìê°€ ì—†ì†Œ.";
          document.getElementById('target-overlay').style.display = 'flex';
        }
      }

      function sendMove(target) {
        socket.emit('playCard', { card: myHand[selectedCardIdx], target: target });
        closeOverlay();
      }

      socket.on('privateNotice', (msg) => {
        document.getElementById('notice-text').innerText = msg;
        document.getElementById('notice-overlay').style.display = 'flex';
      });

      function closeOverlay() { document.querySelectorAll('.overlay').forEach(e => e.style.display = 'none'); }
    </script>
  </body>
</html>
