<!DOCTYPE html>
<html>
  <head>
    <title>ì¡°ì„ ì‹œëŒ€ ëŸ¬ë¸Œë ˆí„°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      body { text-align: center; font-family: 'Noto Sans KR', sans-serif; background-color: #2e2b26; color: #f0e6d2; margin: 0; padding: 0; }
      
      /* ë¡œê·¸ì¸ í™”ë©´ */
      #login-screen { display: flex; flex-direction: column; justify-content: center; height: 100vh; align-items: center; background-color: #2e2b26; }
      input { padding: 15px; font-size: 20px; border-radius: 5px; border: 2px solid #8c7b6c; background-color: #4a4036; color: white; text-align: center; margin-bottom: 20px; width: 80%; max-width: 300px; }
      .btn-custom { padding: 15px 30px; font-size: 22px; background-color: #a63737; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
      
      /* ê²Œì„ í™”ë©´ ë ˆì´ì•„ì›ƒ */
      #game-screen { display: none; max-width: 600px; margin: 0 auto; padding: 10px; height: 100vh; box-sizing: border-box; position: relative; display: flex; flex-direction: column; }
      
      /* ìƒë‹¨ ë°” */
      #top-bar { display: flex; flex-direction: column; background: rgba(0,0,0,0.4); border-radius: 10px; margin-bottom: 5px; padding: 10px; border: 1px solid #5c5042;}
      #top-row { display: flex; justify-content: space-between; align-items: center; width: 100%; }
      #room-info-display { font-size: 16px; font-weight: bold; color: #d4c5a9; }
      #player-names-box { font-size: 13px; color: #9c8e7e; margin-top: 5px; text-align: left; width: 100%; }
      #start-btn { display: none; padding: 8px 15px; background-color: #3e6b46; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; animation: pulse 2s infinite;}
      @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

      /* ê²Œì„ ë¡œê·¸ */
      #game-log { 
        background-color: rgba(0,0,0,0.3); 
        height: 15vh; 
        overflow-y: auto; text-align: left; padding: 10px; border-radius: 10px; 
        font-size: 14px; color: #e0d0b8; border: 1px solid #5c5042; margin-bottom: 5px; flex-shrink: 0;
      }
      .log-item { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 2px; }

      /* í„´ ì •ë³´ */
      #turn-info { font-size: 20px; color: #e6b322; font-weight: bold; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
      
      /* ë‚´ ì¹´ë“œ ì˜ì—­ */
      #hand-container { 
        display: flex; justify-content: center; gap: 10px; 
        margin-bottom: 10px; flex: 1; align-items: center; 
      }
      .card { 
        background-color: #f5f0e1; color: #2e2b26; 
        width: 150px; height: 230px; 
        border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        font-weight: bold; border: 4px solid #d4c5a9; box-shadow: 0 5px 15px rgba(0,0,0,0.6); 
        cursor: pointer; transition: transform 0.2s; text-align: center; padding: 6px;
      }
      
      .card-name { font-size: 30px; margin-bottom: 8px; line-height: 1.2; font-family: "Gungsuh", serif; }
      .card-desc { font-size: 15px; color: #554433; font-weight: normal; line-height: 1.4; word-break: keep-all; }
      
      .card:active { transform: scale(0.95); }
      .card.disabled { opacity: 0.6; filter: grayscale(80%); cursor: not-allowed; }

      /* ë¯¸ë‹ˆì¹´ë“œ ì˜ì—­ */
      #mini-card-area { 
        background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px 8px; margin-top: auto; border: 1px solid #5c5042;
      }
      .mini-card-wrap { 
        display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; 
      }
      .mini-card { 
        width: 23%; max-width: 80px; height: 60px; 
        background-color: #5c5042; color: #e0d0b8; border-radius: 5px; 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        font-size: 11px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid #3d342b; 
        cursor: pointer; 
        transition: transform 0.1s;
      }
      .mini-card:active { transform: scale(0.92); } 
      .mini-card.out { background-color: #2b2520; color: #555; border-color: #222; }
      .mini-count { font-size: 10px; color: #aaa; margin-top: 1px; }
      .mini-card.out .mini-count { color: #444; }

      /* íŒì—… ê³µí†µ ìŠ¤íƒ€ì¼ */
      .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
      .overlay h2 { margin-bottom: 15px; color: #f0e6d2; text-align: center; font-size: 24px;}
      .overlay-content { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; max-width: 90%; }
      .overlay-btn { padding: 15px 20px; font-size: 18px; background-color: #4a4036; color: white; border: 1px solid #8c7b6c; border-radius: 5px; cursor: pointer; margin-bottom: 5px; }
      .card-select-btn { background-color: #e6b322; color: #2e2b26; font-weight: bold; border: none; width: 45%; } 
      
      /* ì•Œë¦¼ì°½ ì „ìš© ìŠ¤íƒ€ì¼ */
      #notice-box {
        background-color: #2e2b26; border: 2px solid #e6b322; 
        padding: 20px; border-radius: 10px; width: 80%; max-width: 300px;
        text-align: center; box-shadow: 0 0 20px rgba(230, 179, 34, 0.3);
      }
      #notice-text { font-size: 18px; color: #fff; margin-bottom: 20px; line-height: 1.5; }
    </style>
  </head>
  <body>

    <div id="login-screen">
      <h1 style="color: #e6b322; font-size: 45px; margin-bottom: 30px; font-family: 'Gungsuh', serif;">ì¡°ì„ ì‹œëŒ€<br>ëŸ¬ë¸Œë ˆí„°</h1>
      <input type="text" id="nickname" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì‹œì˜¤" />
      <button class="btn-custom" onclick="joinGame()" style="margin-top: 20px;">ì…ì¥í•˜ê¸°</button>
    </div>

    <div id="game-screen">
      <div id="top-bar">
        <div id="top-row">
          <span id="room-info-display">ë°©: <span id="room-display"></span> (<span id="player-count">0</span>/4)</span>
          <button id="start-btn" onclick="requestStart()">â–¶ ê²Œì„ ì‹œì‘</button>
        </div>
        <div id="player-names-box">ëŒ€ê¸°ì¤‘...</div>
      </div>

      <div id="game-log"><div class="log-item">ëŒ€ê¸°ì‹¤ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤.</div></div>
      
      <div id="turn-info">ê²Œì„ ëŒ€ê¸°ì¤‘...</div>

      <div id="hand-container">
        <div class="card disabled" id="card0" onclick="clickCard(0)"></div>
        <div class="card disabled" id="card1" onclick="clickCard(1)"></div>
      </div>

      <div id="mini-card-area">
        <div style="font-size: 13px; color: #e6b322; margin-bottom: 8px; font-weight: bold;">
          ğŸ“‹ í˜„ì¬ ë‚¨ì€ ì¹´ë“œ ï½œ ì•„ë˜ ì¹´ë“œë¥¼ ëˆŒëŸ¬ ëŠ¥ë ¥ í™•ì¸
        </div>
        <div id="mini-card-container" class="mini-card-wrap"></div>
      </div>
    </div>

    <div id="target-overlay" class="overlay">
      <h2>ëˆ„êµ¬ë¥¼ ì§€ëª©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
      <div id="target-buttons" class="overlay-content"></div>
      <button class="btn-custom" style="margin-top:20px; background-color:#333;" onclick="closeOverlay()">ì·¨ì†Œ</button>
    </div>

    <div id="guess-overlay" class="overlay">
      <h2>ìƒëŒ€ê°€ ë¬´ìŠ¨ ì¹´ë“œì¼ê¹Œìš”?</h2>
      <div id="guess-buttons" class="overlay-content">
        <button class="overlay-btn card-select-btn" onclick="submitMove('ğŸ­ê´‘ëŒ€(2)')">ğŸ­ê´‘ëŒ€(2)</button>
        <button class="overlay-btn card-select-btn" onclick="submitMove('âš”ï¸ê²€ê°(3)')">âš”ï¸ê²€ê°(3)</button>
        <button class="overlay-btn card-select-btn" onclick="submitMove('ğŸ’Šì˜ë…€(4)')">ğŸ’Šì˜ë…€(4)</button>
        <button class="overlay-btn card-select-btn" onclick="submitMove('ğŸ—¡ï¸ìê°(5)')">ğŸ—¡ï¸ìê°(5)</button>
        <button class="overlay-btn card-select-btn" onclick="submitMove('ğŸ‘‘ì„ê¸ˆ(6)')">ğŸ‘‘ì„ê¸ˆ(6)</button>
        <button class="overlay-btn card-select-btn" onclick="submitMove('ğŸŒºí›„ê¶(7)')">ğŸŒºí›„ê¶(7)</button>
        <button class="overlay-btn card-select-btn" onclick="submitMove('ğŸ‘¸ì™•ë¹„(8)')">ğŸ‘¸ì™•ë¹„(8)</button>
      </div>
      <button class="btn-custom" style="margin-top:20px; background-color:#333;" onclick="closeOverlay()">ì·¨ì†Œ</button>
    </div>

    <div id="notice-overlay" class="overlay">
      <div id="notice-box">
        <div id="notice-text"></div>
        <button class="btn-custom" style="font-size:16px; padding:10px 20px;" onclick="closeOverlay()">í™•ì¸</button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();
      var myHand = [];
      var currentPlayers = [];
      var isMyTurn = false;
      var selectedCardIdx = -1;
      var selectedTarget = "";
      var myName = ""; 

      const cardDescriptions = {
        "1": "ìƒëŒ€ 1ëª…ì„ ì§€ëª©í•´ ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì¶”ì¸¡í•©ë‹ˆë‹¤(í¬ì¡¸ ì œì™¸).\në§íˆë©´ ìƒëŒ€ëŠ” ì¦‰ì‹œ íƒˆë½!",
        "2": "ìƒëŒ€ 1ëª…ì˜ ì¹´ë“œë¥¼\nëª°ë˜ í™•ì¸í•©ë‹ˆë‹¤.",
        "3": "ìƒëŒ€ 1ëª…ê³¼ ìˆ«ìë¥¼ ë¹„êµí•©ë‹ˆë‹¤.\nìˆ«ìê°€ ë‚®ì€ ì‚¬ëŒì´ íƒˆë½í•©ë‹ˆë‹¤.",
        "4": "ë‹¤ìŒ ë‚´ ì°¨ë¡€ ì „ê¹Œì§€\në‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ê³µê²©ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        "5": "ìì‹  ë˜ëŠ” ìƒëŒ€ 1ëª…ì„ ì§€ëª©í•´\nê°€ì§„ ì¹´ë“œë¥¼ ë²„ë¦¬ê³  ìƒˆë¡œ ë½‘ìŠµë‹ˆë‹¤.",
        "6": "ìƒëŒ€ 1ëª…ê³¼\nì¹´ë“œë¥¼ ì„œë¡œ ë§ë°”ê¿‰ë‹ˆë‹¤.",
        "7": "5ë²ˆ(ìê°) ë˜ëŠ” 6ë²ˆ(ì„ê¸ˆ) ì¹´ë“œê°€ í•¨ê»˜ ìˆë‹¤ë©´ ë°˜ë“œì‹œ ì´ ì¹´ë“œë¥¼ ë¨¼ì € ë²„ë ¤ì•¼ í•©ë‹ˆë‹¤. (ê·¸ ì™¸ì—ëŠ” ì„ íƒì ìœ¼ë¡œ ë²„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)",
        "8": "ì´ ì¹´ë“œëŠ” ì ˆëŒ€ ë²„ë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në²„ë ¤ì§€ë©´ ì¦‰ì‹œ íŒ¨ë°°í•©ë‹ˆë‹¤."
      };

      function joinGame() {
        var name = document.getElementById('nickname').value;
        var room = "1"; 
        if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì‹­ì‹œì˜¤!");
        
        myName = name; 
        socket.emit('login', { name: name, roomName: room });
        
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
      }

      function requestStart() { socket.emit('requestStart'); }

      socket.on('roomInfo', (data) => {
        document.getElementById('room-display').innerText = data.roomName || "1";
        document.getElementById('player-count').innerText = data.count;
        var names = Array.isArray(data.names) ? data.names.join(', ') : "ë¡œë”©ì¤‘...";
        document.getElementById('player-names-box').innerText = "ëª…ë‹¨: " + names;
        currentPlayers = data.names;

        var startBtn = document.getElementById('start-btn');
        if (data.count >= 2 && !data.isStarted) startBtn.style.display = 'block';
        else startBtn.style.display = 'none';

        if (!data.isStarted) {
             // [ìˆ˜ì • 2] ëŒ€ê¸° ì¤‘ ì•ˆë‚´ ë¬¸êµ¬ ë³€ê²½
             document.getElementById('turn-info').innerText = "í”Œë ˆì´ì–´ë“¤ì´ ëª¨ë‘ ì…ì¥í•˜ë©´ ê²Œì„ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”";
             document.getElementById('turn-info').style.color = "#aaa";
             document.getElementById('turn-info').style.fontSize = "16px"; // ë¬¸êµ¬ê°€ ê¸¸ì–´ì„œ í°íŠ¸ ì‚¬ì´ì¦ˆ ì‚´ì§ ì¡°ì •
        } else {
             document.getElementById('turn-info').style.fontSize = "20px"; // ê²Œì„ ì‹œì‘ ì‹œ ì›ë˜ í¬ê¸°ë¡œ ë³µêµ¬
        }
      });

      socket.on('gameLog', (msg) => {
        var box = document.getElementById('game-log');
        box.innerHTML += `<div class="log-item">${msg}</div>`;
        box.scrollTop = box.scrollHeight;
      });

      socket.on('turnUpdate', (data) => {
        isMyTurn = (data.turnId === socket.id);
        var info = document.getElementById('turn-info');
        var cards = document.querySelectorAll('.card');

        if (isMyTurn) {
          info.innerText = "ğŸ”¥ ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤! ğŸ”¥";
          info.style.color = "#e6b322";
          cards.forEach(c => c.classList.remove('disabled'));
        } else {
          info.innerText = `â³ ${data.turnName} ë‹˜ì˜ ì°¨ë¡€`;
          info.style.color = "#aaa";
          cards.forEach(c => c.classList.add('disabled'));
        }
      });

      socket.on('updateHand', (cards) => {
        myHand = cards;
        renderCard('card0', myHand[0]);
        renderCard('card1', myHand[1]);
      });

      socket.on('updateCardStats', (stats) => {
        var container = document.getElementById('mini-card-container');
        var html = "";
        stats.forEach(item => {
          var isOut = (item.remaining === 0);
          var cls = isOut ? "mini-card out" : "mini-card";
          
          html += `
            <div class="${cls}" onclick="showCardInfo('${item.num}', '${item.name}')">
              <div style="font-size:10px; color:#aaa;">(${item.num})</div>
              <div style="font-size:11px; margin:2px 0;">${item.name}</div>
              <div class="mini-count">${item.remaining}/${item.total}</div>
            </div>
          `;
        });
        container.innerHTML = html;
      });

      function showCardInfo(num, name) {
        var desc = cardDescriptions[num] || "";
        var formattedDesc = desc.replace(/\n/g, '<br>'); 
        
        document.getElementById('notice-text').innerHTML = `
          <div style="font-size: 22px; color: #e6b322; font-weight: bold; margin-bottom: 15px; font-family: 'Gungsuh', serif;">${name} (${num})</div>
          <div style="font-size: 15px; color: #f0e6d2; line-height: 1.5; word-break: keep-all;">${formattedDesc}</div>
        `;
        document.getElementById('notice-overlay').style.display = 'flex';
      }

      function renderCard(elementId, cardStr) {
        var el = document.getElementById(elementId);
        if (!cardStr) { el.innerHTML = ""; return; }
        var num = cardStr.replace(/[^0-9]/g, "");
        var desc = cardDescriptions[num] || "";
        el.innerHTML = `<div class="card-name">${cardStr}</div><div class="card-desc">${desc}</div>`;
      }

      socket.on('privateNotice', (msg) => {
        document.getElementById('notice-text').innerHTML = `<div style="font-size:16px; color:#fff; line-height:1.4;">ğŸ“¢ ${msg}</div>`;
        document.getElementById('notice-overlay').style.display = 'flex';
      });

      function clickCard(index) {
        if (!isMyTurn) return alert("ì•„ì§ ë‹¹ì‹ ì˜ ì°¨ë¡€ê°€ ì•„ë‹™ë‹ˆë‹¤.");
        if (!myHand[index]) return;
        selectedCardIdx = index;
        var cardName = myHand[index];

        if (cardName.includes("ì˜ë…€") || cardName.includes("í›„ê¶") || cardName.includes("ì™•ë¹„")) {
          selectedTarget = ""; submitMove(null);
        } else {
          openTargetOverlay();
        }
      }

      function openTargetOverlay() {
        var html = "";
        var cardName = myHand[selectedCardIdx]; 

        currentPlayers.forEach(p => {
          if ((cardName.includes("í¬ì¡¸") || cardName.includes("ê´‘ëŒ€") || cardName.includes("ê²€ê°") || cardName.includes("ì„ê¸ˆ")) && p === myName) {
             return; 
          }
          html += `<button class="overlay-btn" onclick="selectTarget('${p}')">${p}</button>`;
        });
        document.getElementById('target-buttons').innerHTML = html;
        document.getElementById('target-overlay').style.display = 'flex';
      }

      function selectTarget(name) {
        var cardName = myHand[selectedCardIdx];
        selectedTarget = name;
        document.getElementById('target-overlay').style.display = 'none';
        
        if (cardName.includes("í¬ì¡¸")) document.getElementById('guess-overlay').style.display = 'flex';
        else submitMove(null);
      }

      function submitMove(guess) {
        var cardName = myHand[selectedCardIdx];
        socket.emit('playCard', { card: cardName, target: selectedTarget, guess: guess });
        closeOverlay();
      }

      function closeOverlay() {
        document.querySelectorAll('.overlay').forEach(el => el.style.display='none');
      }
    </script>
  </body>
</html>
