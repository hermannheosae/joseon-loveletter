<!DOCTYPE html>
<html>
  <head>
    <title>ì¡°ì„ ì‹œëŒ€ ëŸ¬ë¸Œë ˆí„°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      body { text-align: center; font-family: 'Noto Sans KR', sans-serif; background-color: #2e2b26; color: #f0e6d2; margin: 0; padding: 0; }
      #login-screen { display: flex; flex-direction: column; justify-content: center; height: 100vh; align-items: center; background-color: #2e2b26; }
      input { padding: 15px; font-size: 20px; border-radius: 5px; border: 2px solid #8c7b6c; background-color: #4a4036; color: white; text-align: center; margin-bottom: 20px; width: 80%; max-width: 300px; }
      .btn-custom { padding: 15px 30px; font-size: 22px; background-color: #a63737; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
      #game-screen { display: none !important; max-width: 600px; margin: 0 auto; padding: 10px; height: 100vh; box-sizing: border-box; position: relative; flex-direction: column; }
      #top-bar { display: flex; flex-direction: column; background: rgba(0,0,0,0.4); border-radius: 10px; margin-bottom: 5px; padding: 10px; border: 1px solid #5c5042;}
      #room-info-display { font-size: 16px; font-weight: bold; color: #d4c5a9; text-align: left; }
      #player-names-box { font-size: 13px; color: #9c8e7e; margin-top: 5px; text-align: left; width: 100%; }
      #game-log { background-color: rgba(0,0,0,0.3); height: 15vh; overflow-y: auto; text-align: left; padding: 10px; border-radius: 10px; font-size: 14px; color: #e0d0b8; border: 1px solid #5c5042; margin-bottom: 5px; flex-shrink: 0; }
      .log-item { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 2px; }
      #turn-info { font-size: 20px; color: #e6b322; font-weight: bold; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
      #hand-container { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; flex: 1; align-items: center; }
      .card { background-color: #f5f0e1; color: #2e2b26; width: 155px; height: 240px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; border: 4px solid #d4c5a9; box-shadow: 0 5px 15px rgba(0,0,0,0.6); cursor: pointer; transition: transform 0.2s; text-align: center; padding: 8px; }
      .card-name { font-size: 28px; margin-bottom: 10px; line-height: 1.2; font-family: "Gungsuh", serif; }
      .card-desc { font-size: 14px; color: #554433; font-weight: normal; line-height: 1.4; word-break: keep-all; }
      .card:active { transform: scale(0.95); }
      .card.disabled { opacity: 0.6; filter: grayscale(80%); cursor: not-allowed; }
      #mini-card-area { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px 8px; margin-top: auto; border: 1px solid #5c5042; }
      .mini-card-wrap { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; }
      .mini-card { width: 23%; max-width: 80px; height: 60px; background-color: #5c5042; color: #e0d0b8; border-radius: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid #3d342b; cursor: pointer; transition: transform 0.1s; }
      .mini-card.out { background-color: #2b2520; color: #555; border-color: #222; }
      .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
      .overlay h2 { margin-bottom: 15px; color: #f0e6d2; text-align: center; font-size: 24px;}
      .overlay-content { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; max-width: 90%; }
      .overlay-btn { padding: 15px 20px; font-size: 18px; background-color: #4a4036; color: white; border: 1px solid #8c7b6c; border-radius: 5px; cursor: pointer; margin-bottom: 5px; }
      #notice-box { background-color: #2e2b26; border: 2px solid #e6b322; padding: 20px; border-radius: 10px; width: 80%; max-width: 300px; text-align: center; box-shadow: 0 0 20px rgba(230, 179, 34, 0.3); }
      #notice-text { font-size: 18px; color: #fff; margin-bottom: 20px; line-height: 1.5; }
    </style>
  </head>
  <body>
    <div id="login-screen">
      <h1 style="color: #e6b322; font-size: 45px; margin-bottom: 30px; font-family: 'Gungsuh', serif;">ì¡°ì„ ì‹œëŒ€<br>ëŸ¬ë¸Œë ˆí„°</h1>
      <input type="text" id="nickname" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì‹œì˜¤" />
      <button class="btn-custom" onclick="joinGame()" style="margin-top: 20px;">ì…ì¥í•˜ê¸°</button>
    </div>

    <div id="game-screen">
      <div id="top-bar">
        <div style="display:flex; justify-content: space-between; align-items: center;">
          <div id="room-info-display">ë°©: 1 (<span id="player-count">0</span>/4)</div>
          <button id="start-btn" onclick="requestStart()" style="display:none; padding:8px 15px; background-color:#3e6b46; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold; font-size:14px;">â–¶ ê²Œì„ ì‹œì‘</button>
        </div>
        <div id="player-names-box">ëŒ€ê¸°ì¤‘...</div>
      </div>
      <div id="game-log"></div>
      <div id="turn-info">ëª¨ë“  í”Œë ˆì´ì–´ê°€ ë°©ì— ë“¤ì–´ì˜¤ë©´ ê²Œì„ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
      <div id="hand-container">
        <div class="card disabled" id="card0" onclick="clickCard(0)"></div>
        <div class="card disabled" id="card1" onclick="clickCard(1)"></div>
      </div>
      <div id="mini-card-area">
        <div style="font-size: 13px; color: #e6b322; margin-bottom: 8px; font-weight: bold;">ğŸ“‹ ë‚¨ì€ ì¹´ë“œ (í´ë¦­ ì‹œ ëŠ¥ë ¥ í™•ì¸)</div>
        <div id="mini-card-container" class="mini-card-wrap"></div>
      </div>
    </div>

    <div id="target-overlay" class="overlay">
      <h2>ëˆ„êµ¬ë¥¼ ì§€ëª©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
      <div id="target-buttons" style="display:flex; flex-direction:column; align-items:center; width:100%;"></div>
      <button class="btn-custom" style="margin-top:20px; background-color:#333; font-size:16px;" onclick="closeOverlay()">ì·¨ì†Œ</button>
    </div>

    <div id="guess-overlay" class="overlay">
      <h2>ìƒëŒ€ì˜ ì¹´ë“œëŠ”?</h2>
      <div class="overlay-content">
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('ğŸ­ê´‘ëŒ€(2)')">ğŸ­ê´‘ëŒ€(2)</button>
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('âš”ï¸ê²€ê°(3)')">âš”ï¸ê²€ê°(3)</button>
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('ğŸ’Šì˜ë…€(4)')">ğŸ’Šì˜ë…€(4)</button>
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('ğŸ—¡ï¸ìê°(5)')">ğŸ—¡ï¸ìê°(5)</button>
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('ğŸ‘‘ì„ê¸ˆ(6)')">ğŸ‘‘ì„ê¸ˆ(6)</button>
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('ğŸŒºí›„ê¶(7)')">ğŸŒºí›„ê¶(7)</button>
        <button class="overlay-btn" style="background:#e6b322; color:black; font-weight:bold;" onclick="submitMove('ğŸ‘¸ì™•ë¹„(8)')">ğŸ‘¸ì™•ë¹„(8)</button>
      </div>
      <button class="btn-custom" style="margin-top:20px; background-color:#333; font-size:16px;" onclick="closeOverlay()">ì·¨ì†Œ</button>
    </div>

    <div id="notice-overlay" class="overlay">
      <div id="notice-box">
        <div id="notice-text"></div>
        <button class="btn-custom" style="font-size:16px; padding:10px 20px;" onclick="closeOverlay()">í™•ì¸</button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();
      var myHand = [], currentPlayers = [], isMyTurn = false, selectedCardIdx = -1, myName = "", selectedTarget = "";
      
      const cardFullInfo = {
        "1": "ì§€ëª©í•œ ì´ì˜ ë²ˆí˜¸ë¥¼ ë§íˆë©´ íƒˆë½ì‹œí‚µë‹ˆë‹¤ (í¬ì¡¸ ì œì™¸).",
        "2": "ìƒëŒ€ 1ëª…ì˜ ì¹´ë“œë¥¼ ëª°ë˜ í™•ì¸í•©ë‹ˆë‹¤.",
        "3": "ìƒëŒ€ 1ëª…ê³¼ ìˆ«ìë¥¼ ë¹„êµí•˜ì—¬ ë‚®ì€ ì´ê°€ íƒˆë½í•©ë‹ˆë‹¤.",
        "4": "ë‹¤ìŒ ë‚´ ì°¨ë¡€ ì „ê¹Œì§€ ëª¨ë“  ê³µê²©ì„ ë§‰ì•„ëƒ…ë‹ˆë‹¤.",
        "5": "ì§€ëª©í•œ ì´ì˜ ì¹´ë“œë¥¼ ë²„ë¦¬ê²Œ í•˜ê³  ìƒˆë¡œ ë½‘ê²Œ í•©ë‹ˆë‹¤.",
        "6": "ìƒëŒ€ 1ëª…ê³¼ ì¹´ë“œë¥¼ ì„œë¡œ ë§ë°”ê¿‰ë‹ˆë‹¤.",
        "7": "ìê°(5)ì´ë‚˜ ì„ê¸ˆ(6)ì´ ìˆë‹¤ë©´ ë°˜ë“œì‹œ ë¨¼ì € ë²„ë ¤ì•¼ í•©ë‹ˆë‹¤.",
        "8": "ì´ ì¹´ë“œê°€ ë²„ë ¤ì§€ë©´ ì¦‰ì‹œ íŒ¨ë°°í•©ë‹ˆë‹¤."
      };

      const cardDescriptions = {
        "1": "ìƒëŒ€ 1ëª…ì„ ì§€ëª©í•´ ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì¶”ì¸¡í•©ë‹ˆë‹¤(í¬ì¡¸ ì œì™¸). ë§íˆë©´ ìƒëŒ€ëŠ” ì¦‰ì‹œ íƒˆë½!",
        "2": "ìƒëŒ€ 1ëª…ì˜ ì¹´ë“œë¥¼ ëª°ë˜ í™•ì¸í•©ë‹ˆë‹¤.",
        "3": "ìƒëŒ€ 1ëª…ê³¼ ìˆ«ìë¥¼ ë¹„êµí•©ë‹ˆë‹¤. ìˆ«ìê°€ ë‚®ì€ ì‚¬ëŒì´ íƒˆë½í•©ë‹ˆë‹¤.",
        "4": "ë‹¤ìŒ ë‚´ ì°¨ë¡€ ì „ê¹Œì§€ ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ê³µê²©ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        "5": "ìì‹  ë˜ëŠ” ìƒëŒ€ 1ëª…ì„ ì§€ëª©í•´ ê°€ì§„ ì¹´ë“œë¥¼ ë²„ë¦¬ê³  ìƒˆë¡œ ë½‘ìŠµë‹ˆë‹¤.",
        "6": "ìƒëŒ€ 1ëª…ê³¼ ì¹´ë“œë¥¼ ì„œë¡œ ë§ë°”ê¿‰ë‹ˆë‹¤.",
        "7": "5ë²ˆ ë˜ëŠ” 6ë²ˆ ì¹´ë“œê°€ ì†ì— ìˆë‹¤ë©´ ë°˜ë“œì‹œ ì´ ì¹´ë“œë¥¼ ë¨¼ì € ë²„ë ¤ì•¼ í•©ë‹ˆë‹¤.",
        "8": "ì ˆëŒ€ ë²„ë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë²„ë ¤ì§€ë©´ ì¦‰ì‹œ íŒ¨ë°°í•©ë‹ˆë‹¤."
      };

      function joinGame() {
        myName = document.getElementById('nickname').value;
        if(!myName) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì‹œì˜¤!");
        socket.emit('login', { name: myName });
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('game-screen').style.setProperty('display', 'flex', 'important');
      }

      function requestStart() { socket.emit('requestStart'); }

      socket.on('roomInfo', (data) => {
        currentPlayers = data.playerStates || [];
        document.getElementById('player-count').innerText = data.count;
        document.getElementById('player-names-box').innerText = "ëª…ë‹¨: " + currentPlayers.map(p => p.isEliminated ? `[íƒˆë½]${p.name}` : p.name).join(', ');
        document.getElementById('start-btn').style.display = (data.count >= 2 && !data.isStarted) ? 'block' : 'none';
        if(!data.isStarted) document.getElementById('turn-info').innerText = "ëª¨ë“  í”Œë ˆì´ì–´ê°€ ë°©ì— ë“¤ì–´ì˜¤ë©´ ê²Œì„ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”";
      });

      socket.on('gameLog', (msg) => {
        const box = document.getElementById('game-log');
        box.innerHTML += `<div class="log-item">${msg}</div>`;
        box.scrollTop = box.scrollHeight;
      });

      socket.on('turnUpdate', (data) => {
        isMyTurn = (data.turnId === socket.id);
        const info = document.getElementById('turn-info');
        info.innerText = isMyTurn ? "ğŸ”¥ ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤! ğŸ”¥" : `â³ ${data.turnName} ë‹˜ì˜ ì°¨ë¡€`;
        info.style.color = isMyTurn ? "#e6b322" : "#aaa";
        document.querySelectorAll('.card').forEach(c => isMyTurn ? c.classList.remove('disabled') : c.classList.add('disabled'));
      });

      socket.on('updateHand', (cards) => {
        myHand = cards;
        const render = (id, cardStr) => {
          const el = document.getElementById(id);
          if(!cardStr) { el.innerHTML = ""; return; }
          const num = cardStr.replace(/[^0-9]/g, "");
          el.innerHTML = `<div class="card-name">${cardStr}</div><div class="card-desc">${cardFullInfo[num]}</div>`;
        };
        render('card0', myHand[0]); render('card1', myHand[1]);
      });

      socket.on('updateCardStats', (stats) => {
        const cardNames = { "1":"í¬ì¡¸", "2":"ê´‘ëŒ€", "3":"ê²€ê°", "4":"ì˜ë…€", "5":"ìê°", "6":"ì„ê¸ˆ", "7":"í›„ê¶", "8":"ì™•ë¹„" };
        let html = "";
        stats.forEach(item => {
          html += `<div class="mini-card ${item.remaining === 0 ? 'out' : ''}" onclick="showCardInfo('${item.num}', '${cardNames[item.num]}')">
            <div style="font-size:9px;">(${item.num})</div><div>${cardNames[item.num]}</div>
            <div style="font-size:9px;">${item.remaining}/${item.total}</div>
          </div>`;
        });
        document.getElementById('mini-card-container').innerHTML = html;
      });

      function showCardInfo(num, name) {
        document.getElementById('notice-text').innerHTML = `<b style="color:#e6b322; font-size:22px; font-family:Gungsuh;">${name}(${num})</b><br><br>${cardDescriptions[num]}`;
        document.getElementById('notice-overlay').style.display = 'flex';
      }

      function clickCard(idx) {
        if(!isMyTurn || !myHand[idx]) return;
        selectedCardIdx = idx;
        const card = myHand[idx];
        if(card.includes("ì˜ë…€") || card.includes("í›„ê¶") || card.includes("ì™•ë¹„")) {
          selectedTarget = ""; submitMove(null);
        } else {
          let html = "";
          currentPlayers.forEach(p => {
            // 5ë²ˆ ì¹´ë“œ(ìê°)ì¼ ë•ŒëŠ” ë‚˜ ìì‹ ë„ ëª©ë¡ì— í¬í•¨í•¨
            if (card.includes("ìê°") && p.name === myName && !p.isEliminated) {
                html += `<button class="overlay-btn" style="background:#4a6741;" onclick="selectTarget('${p.name}')">${p.name} (ë‚˜ ìì‹ )</button>`;
            } else if (p.name !== myName && !p.isEliminated) {
                html += `<button class="overlay-btn" onclick="selectTarget('${p.name}')">${p.name}</button>`;
            }
          });
          document.getElementById('target-buttons').innerHTML = html || "ì§€ëª©í•  ìƒì¡´ìê°€ ì—†ìŠµë‹ˆë‹¤.";
          document.getElementById('target-overlay').style.display = 'flex';
        }
      }

      function selectTarget(name) {
        selectedTarget = name;
        document.getElementById('target-overlay').style.display = 'none';
        if(myHand[selectedCardIdx].includes("í¬ì¡¸")) document.getElementById('guess-overlay').style.display = 'flex';
        else submitMove(null);
      }

      function submitMove(guess) {
        socket.emit('playCard', { card: myHand[selectedCardIdx], target: selectedTarget, guess: guess });
        closeOverlay();
      }

      socket.on('privateNotice', (msg) => {
        document.getElementById('notice-text').innerText = msg;
        document.getElementById('notice-overlay').style.display = 'flex';
      });

      function closeOverlay() { document.querySelectorAll('.overlay').forEach(e => e.style.display = 'none'); }
    </script>
  </body>
</html>
